<!DOCTYPE html>
<html>
<head>
    <title>Auth Debug Test</title>
</head>
<body>
    <h1>Authentication Debug Test</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        
        function log(message) {
            output.innerHTML += '<div>' + message + '</div>';
            console.log(message);
        }
        
        async function testAuth() {
            log('=== AUTH DEBUG TEST ===');
            
            // Test the exact same hash function
            const hashPassword = async (password) => {
                try {
                    const encoder = new TextEncoder();
                    const saltedPassword = password + 'finance_app_salt_2024';
                    log('üîê Hashing input: ' + saltedPassword);
                    
                    const data = encoder.encode(saltedPassword);
                    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                    const hashArray = Array.from(new Uint8Array(hashBuffer));
                    const hash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                    
                    log('üîê Generated hash: ' + hash);
                    return hash;
                } catch (error) {
                    log('‚ùå Hashing error: ' + error);
                    throw error;
                }
            };
            
            // Test setup
            const testPassword = '123456';
            log('Testing password: ' + testPassword);
            
            const hash1 = await hashPassword(testPassword);
            log('Hash 1: ' + hash1);
            
            // Store in localStorage
            localStorage.setItem('test_hash', hash1);
            log('Stored in localStorage');
            
            // Retrieve from localStorage
            const storedHash = localStorage.getItem('test_hash');
            log('Retrieved from localStorage: ' + storedHash);
            
            // Generate hash again
            const hash2 = await hashPassword(testPassword);
            log('Hash 2: ' + hash2);
            
            // Compare
            log('Hashes match: ' + (hash1 === hash2));
            log('Stored matches hash1: ' + (storedHash === hash1));
            log('Stored matches hash2: ' + (storedHash === hash2));
            
            // Test localStorage persistence
            log('\n=== Testing localStorage persistence ===');
            log('All localStorage keys: ' + Object.keys(localStorage).join(', '));
            
            // Check if finance keys exist
            const financeHash = localStorage.getItem('finance_password_hash');
            const financeAuth = localStorage.getItem('finance_authenticated_persistent');
            log('finance_password_hash: ' + financeHash);
            log('finance_authenticated_persistent: ' + financeAuth);
        }
        
        testAuth();
    </script>
</body>
</html>